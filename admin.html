<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard - Irie Development</title>
    <meta name="description" content="Admin dashboard for Irie Development">
    <meta name="theme-color" content="#007AFF">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .admin-header h1 {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 50%, #FF2D92 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .admin-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .admin-card:hover::before {
            left: 100%;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 122, 255, 0.2);
        }
        
        .admin-card h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .admin-card p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .admin-btn {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }
        
        .admin-btn.newsletter {
            background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
        }
        
        .admin-btn.newsletter:hover {
            box-shadow: 0 8px 25px rgba(52, 199, 89, 0.3);
        }
        
        .admin-btn.analytics {
            background: linear-gradient(135deg, #FF9500 0%, #FF2D92 100%);
        }
        
        .admin-btn.analytics:hover {
            box-shadow: 0 8px 25px rgba(255, 149, 0, 0.3);
        }
        
        .admin-btn.settings {
            background: linear-gradient(135deg, #5856D6 0%, #AF52DE 100%);
        }
        
        .admin-btn.settings:hover {
            box-shadow: 0 8px 25px rgba(88, 86, 214, 0.3);
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Admin Login Styles */
        .admin-login {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 100px;
        }
        
        .admin-input {
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            width: 300px;
        }
        
        .token-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .token-help {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .token-help a {
            color: #007AFF;
            text-decoration: none;
        }
        
        .token-help code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .quick-actions-card {
            margin-top: 2rem;
        }
        
        .quick-actions-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
        }
        
        /* Subscriber Management Modal */
        .subscriber-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
        }

        .subscriber-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .subscriber-modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .subscriber-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .subscriber-modal-header h2 {
            color: var(--text-primary);
            margin: 0;
        }

        .close-modal {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid rgba(255, 59, 48, 0.5);
            color: #FF3B30;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 59, 48, 0.3);
            transform: scale(1.1);
        }

        .subscriber-list {
            margin-top: 1.5rem;
        }

        .subscriber-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .subscriber-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .subscriber-email {
            color: var(--text-primary);
            font-size: 1rem;
            flex: 1;
            word-break: break-all;
        }

        .subscriber-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-delete {
            background: linear-gradient(135deg, #FF3B30 0%, #FF2D55 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 59, 48, 0.3);
        }

        .subscriber-stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .loading-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            display: none;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none !important;
        }

        .notification-success {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #34C759;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            z-index: 10000;
        }

        .refresh-btn-container {
            margin-bottom: 1rem;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }

        /* Export Modal Styles - Matching Subscriber Modal */
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
        }

        .export-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .export-modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 100%;
            position: relative;
        }

        .export-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .export-modal-header h2 {
            color: var(--text-primary);
            margin: 0;
            font-size: 1.8rem;
        }

        .export-stats {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .export-stats-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .export-stats-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .export-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .export-option-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .export-option-icon {
            font-size: 2rem;
        }

        .export-option-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .export-option-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .export-btn {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }

        .export-btn.csv {
            background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
        }

        .export-btn.csv:hover {
            box-shadow: 0 8px 25px rgba(52, 199, 89, 0.3);
        }

        .export-btn.json {
            background: linear-gradient(135deg, #FF9500 0%, #FF2D92 100%);
        }

        .export-btn.json:hover {
            box-shadow: 0 8px 25px rgba(255, 149, 0, 0.3);
        }

        /* App Form Styles */
        .app-form-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .app-form-group {
            display: flex;
            flex-direction: column;
        }

        .app-form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .app-form-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 1rem;
            box-sizing: border-box;
        }

        .app-form-input:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .app-form-help {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: block;
        }

        .app-form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .app-form-btn {
            flex: 1;
        }

        .app-form-btn-cancel {
            background: rgba(255, 59, 48, 0.2);
            color: #FF3B30;
            border: 1px solid rgba(255, 59, 48, 0.5);
        }

        .app-item-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .app-item-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            object-fit: cover;
        }

        .app-item-info {
            flex: 1;
        }

        .app-item-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .app-item-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .app-item-link {
            color: #007AFF;
            font-size: 0.85rem;
            text-decoration: none;
        }

        .app-item-link:hover {
            text-decoration: underline;
        }

        .btn-edit {
            padding: 8px 16px;
            font-size: 0.9rem;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        }

        .btn-add-app {
            background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
        }

        .app-form-modal-content {
            max-width: 600px;
        }

        .analytics-empty {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .analytics-empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .analytics-empty-subtext {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            opacity: 0.7;
        }

        .analytics-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analytics-stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .analytics-stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .analytics-stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .analytics-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .analytics-stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .analytics-section {
            margin-bottom: 2rem;
        }

        .analytics-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .analytics-chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            min-height: 200px;
            margin-bottom: 1rem;
        }

        .simple-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 150px;
            gap: 2px;
        }

        .simple-chart-bar {
            flex: 1;
            background: linear-gradient(180deg, #007AFF 0%, #5856D6 100%);
            border-radius: 4px 4px 0 0;
            min-height: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .simple-chart-bar:hover {
            background: linear-gradient(180deg, #0051D5 0%, #4A3FB8 100%);
            transform: scaleY(1.05);
        }

        .analytics-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 0.5rem;
        }

        .analytics-activity-list {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 1.5rem;
        }

        .activity-details {
            flex: 1;
        }

        .activity-details strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.25rem;
        }

        .activity-timestamp {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }
            
            .admin-header h1 {
                font-size: 2rem;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .back-btn {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 2rem;
                display: inline-block;
            }

            .subscriber-modal.active,
            .export-modal.active {
                padding: 1rem;
            }

            .subscriber-modal-content,
            .export-modal-content {
                padding: 1.5rem;
            }

            .subscriber-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .subscriber-actions {
                width: 100%;
            }

            .btn-delete {
                width: 100%;
            }

            .export-option {
                padding: 1rem;
            }

            .export-option-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .export-option-desc {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Login Form -->
    <div id="loginSection" class="admin-login">
        <h3>üîí Admin Access Required</h3>
        <p>Enter your GitHub Personal Access Token to access the admin dashboard:</p>
        <div class="token-input">
            <input type="password" id="githubToken" placeholder="Enter GitHub Personal Access Token" class="admin-input">
            <button type="button" onclick="verifyGitHubToken()" class="admin-btn">Verify Token</button>
        </div>
        <div class="token-help">
            <p><small>üí° Create a token at: <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings &gt; Developer settings &gt; Personal access tokens</a></small></p>
            <p><small>üîë Token needs: <code>read:user</code> scope</small></p>
        </div>
    </div>

    <!-- Admin Dashboard (Hidden by default) -->
    <div id="adminSection" class="admin-container" style="display: none;">
        <a href="index.html" class="back-btn">‚Üê Back to Site</a>

        <div class="admin-header">
            <h1>üîß Admin Dashboard</h1>
            <p>Manage your Irie Development website and applications</p>
        </div>

        <div class="admin-grid">
            <div class="admin-card">
                <h3>üìß Newsletter Management</h3>
                <p>Send newsletters to your subscribers, manage subscriber list, and view analytics.</p>
                <a href="send_newsletter.html" class="admin-btn newsletter">Manage Newsletter</a>
            </div>

            <div class="admin-card">
                <h3>üë• Subscriber Management</h3>
                <p>View all subscribers, remove individual subscribers, and manage your subscriber list.</p>
                <button type="button" onclick="openSubscriberManager()" class="admin-btn newsletter">Manage Subscribers</button>
            </div>

            <div class="admin-card">
                <h3>üìä Analytics</h3>
                <p>View website analytics, subscriber growth, and newsletter performance metrics.</p>
                <button type="button" class="admin-btn analytics" onclick="openAnalytics()">View Analytics</button>
            </div>

            <div class="admin-card">
                <h3>‚öôÔ∏è Settings</h3>
                <p>Configure website settings, update content, and manage admin preferences.</p>
                <a href="#" class="admin-btn settings" onclick="alert('Settings coming soon!')">Manage Settings</a>
            </div>

            <div class="admin-card">
                <h3>üì± App Management</h3>
                <p>Update app information, add new apps, and manage App Store links.</p>
                <button type="button" class="admin-btn" onclick="openAppManager()">Manage Apps</button>
            </div>

            <div class="admin-card">
                <h3>üõçÔ∏è Store Management</h3>
                <p>Manage your Arkansas merch store, update products, and view sales data.</p>
                <a href="#" class="admin-btn" onclick="alert('Store management coming soon!')">Manage Store</a>
            </div>

            <div class="admin-card">
                <h3>üìÑ Content Editor</h3>
                <p>Edit website content, update pages, and manage SEO settings.</p>
                <a href="#" class="admin-btn" onclick="alert('Content editor coming soon!')">Edit Content</a>
            </div>
        </div>

        <div class="admin-card quick-actions-card">
            <h3>üöÄ Quick Actions</h3>
            <p>Quick access to frequently used admin functions.</p>
            <div class="quick-actions-buttons">
                <a href="send_newsletter.html" class="admin-btn newsletter">Send Newsletter</a>
                <a href="index.html" class="admin-btn">View Site</a>
                <button type="button" class="admin-btn" onclick="openExportModal()">üì• Export Data</button>
            </div>
        </div>
    </div>

    <!-- Export Data Modal -->
    <div id="exportModal" class="export-modal">
        <div class="export-modal-content">
            <div class="export-modal-header">
                <h2>üì• Export Data</h2>
                <button type="button" class="close-modal" onclick="closeExportModal()" aria-label="Close">&times;</button>
            </div>

            <div class="export-stats" id="exportStats">
                <div class="export-stats-value" id="exportSubscriberCount">‚Äî</div>
                <div class="export-stats-label">Subscribers Available</div>
            </div>

            <div class="export-options">
                <div class="export-option">
                    <div class="export-option-header">
                        <span class="export-option-icon">üìä</span>
                        <span class="export-option-title">Export as CSV</span>
                    </div>
                    <p class="export-option-desc">Comma-separated values format. Perfect for Excel, Google Sheets, and data analysis.</p>
                    <button type="button" class="export-btn csv" onclick="exportSubscribers('csv')">
                        üì• Download CSV
                    </button>
                </div>

                <div class="export-option">
                    <div class="export-option-header">
                        <span class="export-option-icon">üìÑ</span>
                        <span class="export-option-title">Export as JSON</span>
                    </div>
                    <p class="export-option-desc">JavaScript Object Notation format. Perfect for backups and programmatic use.</p>
                    <button type="button" class="export-btn json" onclick="exportSubscribers('json')">
                        üì• Download JSON
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Management Modal -->
    <div id="appModal" class="subscriber-modal">
        <div class="subscriber-modal-content">
            <div class="subscriber-modal-header">
                <h2>üì± App Management</h2>
                <button type="button" class="close-modal" onclick="closeAppManager()" aria-label="Close">&times;</button>
            </div>

            <div class="subscriber-stats hidden" id="appStats">
                <div class="stat-item">
                    <div class="stat-value" id="totalApps">0</div>
                    <div class="stat-label">Total Apps</div>
                </div>
            </div>

            <div class="refresh-btn-container">
                <button type="button" onclick="loadApps()" class="refresh-btn" id="refreshAppsBtn">
                    üîÑ Refresh List
                </button>
                <button type="button" onclick="openAddAppForm()" class="refresh-btn btn-add-app">
                    ‚ûï Add New App
                </button>
            </div>

            <div id="appListContainer">
                <div class="loading-state" id="appLoadingState">
                    <p>‚è≥ Loading apps...</p>
                </div>
                <div class="subscriber-list hidden" id="appList"></div>
                <div class="empty-state hidden" id="appEmptyState">
                    <div class="empty-state-icon">üì±</div>
                    <p>No apps found. Add your first app!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit App Form Modal -->
    <div id="appFormModal" class="subscriber-modal">
        <div class="subscriber-modal-content app-form-modal-content">
            <div class="subscriber-modal-header">
                <h2 id="appFormTitle">‚ûï Add New App</h2>
                <button type="button" class="close-modal" onclick="closeAppForm()" aria-label="Close">&times;</button>
            </div>

            <form id="appForm" onsubmit="saveApp(event)">
                <div class="app-form-container">
                    <div class="app-form-group">
                        <label for="appTitle" class="app-form-label">App Title:</label>
                        <input type="text" id="appTitle" required class="app-form-input" placeholder="e.g., Sudoku Mindscape - Basic">
                    </div>

                    <div class="app-form-group">
                        <label for="appDesc" class="app-form-label">Category/Description:</label>
                        <input type="text" id="appDesc" required class="app-form-input" placeholder="e.g., Puzzle, Travel, Education">
                    </div>

                    <div class="app-form-group">
                        <label for="appUrl" class="app-form-label">App Store URL:</label>
                        <input type="url" id="appUrl" required class="app-form-input" placeholder="https://apps.apple.com/us/app/...">
                    </div>

                    <div class="app-form-group">
                        <label for="appIcon" class="app-form-label">App Icon URL:</label>
                        <input type="url" id="appIcon" required class="app-form-input" placeholder="https://is1-ssl.mzstatic.com/image/thumb/...">
                        <small class="app-form-help">Image URL from App Store or your hosting</small>
                    </div>

                    <div class="app-form-actions">
                        <button type="submit" class="refresh-btn app-form-btn">
                            üíæ Save App
                        </button>
                        <button type="button" onclick="closeAppForm()" class="refresh-btn app-form-btn app-form-btn-cancel">
                            Cancel
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Analytics Dashboard Modal -->
    <div id="analyticsModal" class="subscriber-modal">
        <div class="subscriber-modal-content analytics-modal-content">
            <div class="subscriber-modal-header">
                <h2>üìä Analytics Dashboard</h2>
                <button type="button" class="close-modal" onclick="closeAnalytics()" aria-label="Close">&times;</button>
            </div>

            <div class="analytics-stats-grid" id="analyticsStatsGrid">
                <div class="analytics-stat-card">
                    <div class="analytics-stat-icon">üë•</div>
                    <div class="analytics-stat-value" id="totalSubscribersStat">‚Äî</div>
                    <div class="analytics-stat-label">Total Subscribers</div>
                </div>
                <div class="analytics-stat-card">
                    <div class="analytics-stat-icon">üìà</div>
                    <div class="analytics-stat-value" id="growthRateStat">‚Äî</div>
                    <div class="analytics-stat-label">Growth Rate</div>
                </div>
                <div class="analytics-stat-card">
                    <div class="analytics-stat-icon">üì±</div>
                    <div class="analytics-stat-value" id="totalAppsStat">‚Äî</div>
                    <div class="analytics-stat-label">Total Apps</div>
                </div>
                <div class="analytics-stat-card">
                    <div class="analytics-stat-icon">üìß</div>
                    <div class="analytics-stat-value" id="newsletterSendsStat">‚Äî</div>
                    <div class="analytics-stat-label">Newsletters Sent</div>
                </div>
            </div>

            <div class="analytics-section">
                <h3>üìà Subscriber Growth</h3>
                <div class="analytics-chart-container">
                    <div id="subscriberGrowthChart" class="simple-chart">
                        <div class="analytics-empty">Loading chart data...</div>
                    </div>
                </div>
                <p class="analytics-note">Subscriber count over time (last 30 days)</p>
            </div>

            <div class="analytics-section">
                <h3>üìä Recent Activity</h3>
                <div id="recentActivityList" class="analytics-activity-list">
                    <div class="loading-state">
                        <p>‚è≥ Loading activity...</p>
                    </div>
                </div>
            </div>

            <div class="refresh-btn-container">
                <button type="button" onclick="loadAnalytics()" class="refresh-btn" id="refreshAnalyticsBtn">
                    üîÑ Refresh Analytics
                </button>
            </div>
        </div>
    </div>

    <!-- Subscriber Management Modal -->
    <div id="subscriberModal" class="subscriber-modal">
        <div class="subscriber-modal-content">
            <div class="subscriber-modal-header">
                <h2>üë• Subscriber Management</h2>
                <button type="button" class="close-modal" onclick="closeSubscriberManager()" aria-label="Close">&times;</button>
            </div>

            <div class="subscriber-stats hidden" id="subscriberStats">
                <div class="stat-item">
                    <div class="stat-value" id="totalSubscribers">0</div>
                    <div class="stat-label">Total Subscribers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="displayedSubscribers">0</div>
                    <div class="stat-label">Displayed</div>
                </div>
            </div>

            <div class="refresh-btn-container">
                <button type="button" onclick="loadSubscribers()" class="refresh-btn" id="refreshSubscribersBtn">
                    üîÑ Refresh List
                </button>
            </div>

            <div id="subscriberListContainer">
                <div class="loading-state" id="loadingState">
                    <p>‚è≥ Loading subscribers...</p>
                </div>
                <div class="subscriber-list hidden" id="subscriberList"></div>
                <div class="empty-state hidden" id="emptyState">
                    <div class="empty-state-icon">üì≠</div>
                    <p>No subscribers found</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GitHub Authentication configuration
        const GITHUB_CONFIG = {
            allowedUsers: ['iriecoffelt']
        };
        
        // GitHub Personal Access Token verification
        async function verifyGitHubToken() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                alert('‚ùå Please enter a GitHub Personal Access Token.');
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'Irie-Development-Admin'
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    console.log('GitHub user:', user);
                    
                    if (GITHUB_CONFIG.allowedUsers.includes(user.login)) {
                        // Authorized user
                        document.getElementById('loginSection').style.display = 'none';
                        document.getElementById('adminSection').style.display = 'block';
                        
                        // Store token securely (sessionStorage for this session only)
                        sessionStorage.setItem('github_token', token);
                        sessionStorage.setItem('github_user', user.login);
                        
                        alert(`‚úÖ Welcome, ${user.login}! Access granted.`);
                    } else {
                        alert('‚ùå Access denied. Only authorized users can access this page.');
                        document.getElementById('githubToken').value = '';
                    }
                } else {
                    alert('‚ùå Invalid token. Please check your GitHub Personal Access Token.');
                    document.getElementById('githubToken').value = '';
                }
            } catch (error) {
                console.error('GitHub API error:', error);
                alert('‚ùå Error verifying token. Please try again.');
                document.getElementById('githubToken').value = '';
            }
        }
        
        // Check if user is already authenticated
        function checkGitHubAuth() {
            const token = sessionStorage.getItem('github_token');
            const user = sessionStorage.getItem('github_user');
            
            if (token && user && GITHUB_CONFIG.allowedUsers.includes(user)) {
                // User is already authenticated
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
            }
        }
        
        // Subscriber Management Functions
        function openSubscriberManager() {
            const modal = document.getElementById('subscriberModal');
            modal.classList.add('active');
            loadSubscribers();
        }

        function closeSubscriberManager() {
            const modal = document.getElementById('subscriberModal');
            modal.classList.remove('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('subscriberModal');
            if (e.target === modal) {
                closeSubscriberManager();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSubscriberManager();
            }
        });

        // Load and display subscribers
        async function loadSubscribers() {
            const loadingState = document.getElementById('loadingState');
            const subscriberList = document.getElementById('subscriberList');
            const emptyState = document.getElementById('emptyState');
            const subscriberStats = document.getElementById('subscriberStats');
            const refreshBtn = document.getElementById('refreshSubscribersBtn');

            // Show loading state
            loadingState.classList.remove('hidden');
            subscriberList.classList.add('hidden');
            emptyState.classList.add('hidden');
            subscriberStats.classList.add('hidden');
            refreshBtn.disabled = true;
            refreshBtn.textContent = '‚è≥ Loading...';

            try {
                // Wait for newsletter manager to be available
                if (typeof newsletterManager === 'undefined') {
                    // Wait a bit for the script to load
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                let subscribers = [];

                // Try to get subscribers from newsletter manager
                if (typeof newsletterManager !== 'undefined') {
                    await newsletterManager.loadSubscribers();
                    subscribers = newsletterManager.subscribers || [];
                } else {
                    // Fallback: fetch from JSONBin directly
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            },
                            cache: 'no-store'
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            subscribers = data.subscribers || [];
                        }
                    }

                    // Final fallback: local file
                    if (subscribers.length === 0) {
                        const response = await fetch('/data/subscribers.json', {
                            cache: 'no-store'
                        });
                        if (response.ok) {
                            subscribers = await response.json();
                        }
                    }
                }

                // Update stats
                document.getElementById('totalSubscribers').textContent = subscribers.length.toLocaleString();
                document.getElementById('displayedSubscribers').textContent = subscribers.length.toLocaleString();
                subscriberStats.classList.remove('hidden');
                subscriberStats.style.display = 'flex';

                // Display subscribers
                if (subscribers.length === 0) {
                    loadingState.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                } else {
                    displaySubscribers(subscribers);
                    loadingState.classList.add('hidden');
                    subscriberList.classList.remove('hidden');
                }

            } catch (error) {
                console.error('Error loading subscribers:', error);
                loadingState.innerHTML = '<p style="color: #FF3B30;">‚ùå Error loading subscribers. Check console for details.</p>';
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'üîÑ Refresh List';
            }
        }

        // Display subscribers in the list
        function displaySubscribers(subscribers) {
            const subscriberList = document.getElementById('subscriberList');
            subscriberList.innerHTML = '';

            subscribers.forEach((email, index) => {
                const item = document.createElement('div');
                item.className = 'subscriber-item';
                item.innerHTML = `
                    <span class="subscriber-email">${email}</span>
                    <div class="subscriber-actions">
                        <button type="button" class="btn-delete" onclick="deleteSubscriber('${email}', ${index})" title="Delete subscriber">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                `;
                subscriberList.appendChild(item);
            });
        }

        // Delete a subscriber
        async function deleteSubscriber(email, index) {
            if (!confirm(`Are you sure you want to remove ${email} from the subscriber list?`)) {
                return;
            }

            try {
                // Remove from newsletter manager if available
                if (typeof newsletterManager !== 'undefined') {
                    await newsletterManager.removeSubscriber(email);
                } else {
                    // Fallback: manual removal
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        
                        // Fetch current data
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            }
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            let subscribers = data.subscribers || [];
                            
                            // Remove the email
                            subscribers = subscribers.filter(e => e !== email);
                            
                            // Update JSONBin
                            const updateResponse = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-Access-Key': accessKey
                                },
                                body: JSON.stringify({
                                    subscribers: subscribers,
                                    lastUpdated: new Date().toISOString(),
                                    count: subscribers.length
                                })
                            });
                            
                            if (!updateResponse.ok) {
                                throw new Error('Failed to update JSONBin');
                            }
                        }
                    }
                }

                // Reload the list
                await loadSubscribers();
                
                // Show success message
                const notification = document.createElement('div');
                notification.className = 'notification-success';
                notification.textContent = `‚úÖ ${email} removed successfully`;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);

            } catch (error) {
                console.error('Error deleting subscriber:', error);
                alert('‚ùå Failed to delete subscriber: ' + error.message);
            }
        }

        // Export Data Functions
        function openExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.add('active');
            loadExportStats();
        }

        function closeExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.remove('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('exportModal');
            if (e.target === modal) {
                closeExportModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeExportModal();
            }
        });

        // Load export statistics
        async function loadExportStats() {
            const countElement = document.getElementById('exportSubscriberCount');
            if (!countElement) return;

            countElement.textContent = '...';

            try {
                let count = 0;

                // Try to get count from newsletter manager
                if (typeof newsletterManager !== 'undefined') {
                    count = await newsletterManager.getSubscriberCount();
                } else {
                    // Fallback: fetch from JSONBin directly
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            },
                            cache: 'no-store'
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            const subscribers = data.subscribers || [];
                            count = Array.isArray(subscribers) ? subscribers.length : (data.count || 0);
                        }
                    }

                    // Final fallback: local file
                    if (count === 0) {
                        const response = await fetch('/data/subscribers.json', {
                            cache: 'no-store'
                        });
                        if (response.ok) {
                            const data = await response.json();
                            count = Array.isArray(data) ? data.length : 0;
                        }
                    }
                }

                countElement.textContent = count.toLocaleString();
            } catch (error) {
                console.error('Error loading export stats:', error);
                countElement.textContent = 'Error';
            }
        }

        // Export subscribers in specified format
        async function exportSubscribers(format) {
            try {
                // Get subscribers
                let subscribers = [];

                if (typeof newsletterManager !== 'undefined') {
                    await newsletterManager.loadSubscribers();
                    subscribers = newsletterManager.subscribers || [];
                } else {
                    // Fallback: fetch from JSONBin directly
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            },
                            cache: 'no-store'
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            subscribers = data.subscribers || [];
                        }
                    }

                    // Final fallback: local file
                    if (subscribers.length === 0) {
                        const response = await fetch('/data/subscribers.json', {
                            cache: 'no-store'
                        });
                        if (response.ok) {
                            subscribers = await response.json();
                        }
                    }
                }

                if (subscribers.length === 0) {
                    alert('‚ö†Ô∏è No subscribers to export.');
                    return;
                }

                let content, filename, mimeType;

                if (format === 'csv') {
                    // Create CSV content
                    const headers = ['Email', 'Export Date'];
                    const rows = subscribers.map(email => [email, new Date().toISOString()]);
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
                    ].join('\n');

                    content = csvContent;
                    filename = `subscribers_${new Date().toISOString().split('T')[0]}.csv`;
                    mimeType = 'text/csv;charset=utf-8;';
                } else if (format === 'json') {
                    // Create JSON content with metadata
                    const exportData = {
                        exportDate: new Date().toISOString(),
                        totalSubscribers: subscribers.length,
                        subscribers: subscribers,
                        version: '1.0'
                    };

                    content = JSON.stringify(exportData, null, 2);
                    filename = `subscribers_${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json;charset=utf-8;';
                } else {
                    throw new Error('Invalid export format');
                }

                // Create download link
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // Show success notification
                const notification = document.createElement('div');
                notification.className = 'notification-success';
                notification.textContent = `‚úÖ Exported ${subscribers.length} subscribers as ${format.toUpperCase()}`;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);

            } catch (error) {
                console.error('Error exporting subscribers:', error);
                alert('‚ùå Failed to export subscribers: ' + error.message);
            }
        }

        // Export Data Functions
        function openExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.add('active');
            loadExportStats();
        }

        function closeExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.remove('active');
        }

        // Close export modal when clicking outside
        document.addEventListener('click', (e) => {
            const exportModal = document.getElementById('exportModal');
            if (e.target === exportModal) {
                closeExportModal();
            }
        });

        // Load export statistics
        async function loadExportStats() {
            const countElement = document.getElementById('exportSubscriberCount');
            if (!countElement) return;

            countElement.textContent = '...';

            try {
                let count = 0;

                // Try to get count from newsletter manager
                if (typeof newsletterManager !== 'undefined') {
                    count = await newsletterManager.getSubscriberCount();
                } else {
                    // Fallback: fetch from JSONBin directly
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            },
                            cache: 'no-store'
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            const subscribers = data.subscribers || [];
                            count = Array.isArray(subscribers) ? subscribers.length : (data.count || 0);
                        }
                    }

                    // Final fallback: local file
                    if (count === 0) {
                        const response = await fetch('/data/subscribers.json', {
                            cache: 'no-store'
                        });
                        if (response.ok) {
                            const data = await response.json();
                            count = Array.isArray(data) ? data.length : 0;
                        }
                    }
                }

                countElement.textContent = count.toLocaleString();
            } catch (error) {
                console.error('Error loading export stats:', error);
                countElement.textContent = 'Error';
            }
        }

        // Export subscribers in specified format
        async function exportSubscribers(format) {
            try {
                // Get subscribers
                let subscribers = [];

                if (typeof newsletterManager !== 'undefined') {
                    await newsletterManager.loadSubscribers();
                    subscribers = newsletterManager.subscribers || [];
                } else {
                    // Fallback: fetch from JSONBin directly
                    const binId = localStorage.getItem('jsonbin_bin_id');
                    if (binId) {
                        const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            headers: {
                                'X-Access-Key': accessKey
                            },
                            cache: 'no-store'
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record || result;
                            subscribers = data.subscribers || [];
                        }
                    }

                    // Final fallback: local file
                    if (subscribers.length === 0) {
                        const response = await fetch('/data/subscribers.json', {
                            cache: 'no-store'
                        });
                        if (response.ok) {
                            subscribers = await response.json();
                        }
                    }
                }

                if (subscribers.length === 0) {
                    alert('‚ö†Ô∏è No subscribers to export.');
                    return;
                }

                let content, filename, mimeType;

                if (format === 'csv') {
                    // Create CSV content
                    const headers = ['Email', 'Export Date'];
                    const rows = subscribers.map(email => [email, new Date().toISOString()]);
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
                    ].join('\n');

                    content = csvContent;
                    filename = `subscribers_${new Date().toISOString().split('T')[0]}.csv`;
                    mimeType = 'text/csv;charset=utf-8;';
                } else if (format === 'json') {
                    // Create JSON content with metadata
                    const exportData = {
                        exportDate: new Date().toISOString(),
                        totalSubscribers: subscribers.length,
                        subscribers: subscribers,
                        version: '1.0'
                    };

                    content = JSON.stringify(exportData, null, 2);
                    filename = `subscribers_${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json;charset=utf-8;';
                } else {
                    throw new Error('Invalid export format');
                }

                // Create download link
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // Show success notification
                const notification = document.createElement('div');
                notification.className = 'notification-success';
                notification.textContent = `‚úÖ Exported ${subscribers.length} subscribers as ${format.toUpperCase()}`;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);

            } catch (error) {
                console.error('Error exporting subscribers:', error);
                alert('‚ùå Failed to export subscribers: ' + error.message);
            }
        }

        // App Management Functions
        let editingAppIndex = null;
        let apps = [];

        function openAppManager() {
            const modal = document.getElementById('appModal');
            modal.classList.add('active');
            loadApps();
        }

        function closeAppManager() {
            const modal = document.getElementById('appModal');
            modal.classList.remove('active');
        }

        function openAddAppForm() {
            editingAppIndex = null;
            document.getElementById('appFormTitle').textContent = '‚ûï Add New App';
            document.getElementById('appForm').reset();
            const modal = document.getElementById('appFormModal');
            modal.classList.add('active');
        }

        function openEditAppForm(index) {
            editingAppIndex = index;
            const app = apps[index];
            document.getElementById('appFormTitle').textContent = '‚úèÔ∏è Edit App';
            document.getElementById('appTitle').value = app.title;
            document.getElementById('appDesc').value = app.description;
            document.getElementById('appUrl').value = app.url;
            document.getElementById('appIcon').value = app.icon;
            const modal = document.getElementById('appFormModal');
            modal.classList.add('active');
        }

        function closeAppForm() {
            const modal = document.getElementById('appFormModal');
            modal.classList.remove('active');
            editingAppIndex = null;
        }

        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            const appModal = document.getElementById('appModal');
            const appFormModal = document.getElementById('appFormModal');
            if (e.target === appModal) closeAppManager();
            if (e.target === appFormModal) closeAppForm();
        });

        // Load apps from cloud storage
        async function loadApps() {
            const loadingState = document.getElementById('appLoadingState');
            const appList = document.getElementById('appList');
            const emptyState = document.getElementById('appEmptyState');
            const appStats = document.getElementById('appStats');
            const refreshBtn = document.getElementById('refreshAppsBtn');

            loadingState.classList.remove('hidden');
            appList.classList.add('hidden');
            emptyState.classList.add('hidden');
            appStats.classList.add('hidden');
            refreshBtn.disabled = true;
            refreshBtn.textContent = '‚è≥ Loading...';

            try {
                // Try to load from JSONBin (use public apps bin)
                const binId = localStorage.getItem('apps_bin_id') || '69670ee1d0ea881f406a814c'; // Public apps bin
                const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    headers: {
                        'X-Access-Key': accessKey
                    },
                    cache: 'no-store'
                });

                if (response.ok) {
                    const result = await response.json();
                    const data = result.record || result;
                    apps = data.apps || [];
                } else if (response.status === 404) {
                    // Bin doesn't exist yet, initialize with default apps
                    apps = getDefaultApps();
                    await saveApps();
                } else {
                    throw new Error(`Failed to load: ${response.status}`);
                }

                // Update stats
                document.getElementById('totalApps').textContent = apps.length.toLocaleString();
                appStats.classList.remove('hidden');
                appStats.style.display = 'flex';

                // Display apps
                if (apps.length === 0) {
                    loadingState.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                } else {
                    displayApps();
                    loadingState.classList.add('hidden');
                    appList.classList.remove('hidden');
                }

            } catch (error) {
                console.error('Error loading apps:', error);
                // Fallback to default apps
                apps = getDefaultApps();
                displayApps();
                loadingState.classList.add('hidden');
                appList.classList.remove('hidden');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'üîÑ Refresh List';
            }
        }

        // Get default apps (from current index.html)
        function getDefaultApps() {
            return [
                {
                    title: 'Sudoku Mindscape - Basic',
                    description: 'Puzzle',
                    url: 'https://apps.apple.com/us/app/sudoku-mindscape/id6745157437',
                    icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/8a/fe/d7/8afed7e5-ef74-5dcd-b430-1bcd35851d4d/AppIcon-0-0-1x_U007epad-0-1-85-220.png/540x540bb.jpg'
                },
                {
                    title: 'Sudoku Mindscape - Pro',
                    description: 'Puzzle',
                    url: 'https://apps.apple.com/us/app/sudoku-mindscape-pro/id6749170748',
                    icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/d2/df/ab/d2dfab9b-25c0-8935-7579-e030ec38e241/AppIcon-0-0-1x_U007epad-0-1-85-220.png/540x540bb.jpg'
                },
                {
                    title: 'Hidden Secrets of Arkansas',
                    description: 'Travel',
                    url: 'https://apps.apple.com/us/app/hidden-secrets-of-arkansas/id1576165434',
                    icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/ee/db/73/eedb73da-4212-a1ec-c4fd-e3bcd118b15b/AppIcon-0-1x_U007epad-0-7-0-sRGB-85-220-0.png/540x540bb.jpg'
                },
                {
                    title: 'Oliver\'s Whiteboard',
                    description: 'Education',
                    url: 'https://apps.apple.com/us/app/olivers-whiteboard/id1554030752',
                    icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple114/v4/3d/37/92/3d3792af-8fc8-7d64-a95d-60d6d616b796/AppIcon-0-1x_U007emarketing-0-7-0-sRGB-85-220.png/540x540bb.jpg'
                }
            ];
        }

        // Display apps in the list
        function displayApps() {
            const appList = document.getElementById('appList');
            appList.innerHTML = '';

            apps.forEach((app, index) => {
                const item = document.createElement('div');
                item.className = 'subscriber-item';
                item.innerHTML = `
                    <div class="app-item-content">
                        <img src="${app.icon}" alt="${app.title}" class="app-item-icon">
                        <div class="app-item-info">
                            <div class="app-item-title">${app.title}</div>
                            <div class="app-item-desc">${app.description}</div>
                            <a href="${app.url}" target="_blank" class="app-item-link">View on App Store ‚Üí</a>
                        </div>
                    </div>
                    <div class="subscriber-actions">
                        <button type="button" class="admin-btn btn-edit" onclick="openEditAppForm(${index})">
                            ‚úèÔ∏è Edit
                        </button>
                        <button type="button" class="btn-delete" onclick="deleteApp(${index})" title="Delete app">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                `;
                appList.appendChild(item);
            });
        }

        // Save apps to cloud storage and local file
        async function saveApps() {
            try {
                // Use the public apps bin ID
                const binId = localStorage.getItem('apps_bin_id') || '69670ee1d0ea881f406a814c';
                const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                
                const data = {
                    apps: apps,
                    lastUpdated: new Date().toISOString(),
                    count: apps.length
                };

                // Save to JSONBin (public bin, but requires access key to write)
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': accessKey
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Failed to update JSONBin: ${response.status}`);
                }

                // Store bin ID for future use
                localStorage.setItem('apps_bin_id', binId);

                // Also save to local file for public access (no auth needed)
                // Note: This requires server-side write capability or manual upload
                // For now, we'll download the file for manual upload
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'apps.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                console.log('‚úÖ Apps saved to cloud storage');
                console.log('üì• Apps file downloaded - please upload to /data/apps.json on your server');
                return true;
            } catch (error) {
                console.error('Error saving apps:', error);
                throw error;
            }
        }

        // Save app (from form)
        async function saveApp(event) {
            event.preventDefault();
            
            const title = document.getElementById('appTitle').value.trim();
            const description = document.getElementById('appDesc').value.trim();
            const url = document.getElementById('appUrl').value.trim();
            const icon = document.getElementById('appIcon').value.trim();

            if (!title || !description || !url || !icon) {
                alert('‚ùå Please fill in all fields.');
                return;
            }

            const app = { title, description, url, icon };

            try {
                if (editingAppIndex !== null) {
                    // Update existing app
                    apps[editingAppIndex] = app;
                } else {
                    // Add new app
                    apps.push(app);
                }

                await saveApps();
                await loadApps();
                closeAppForm();

                const notification = document.createElement('div');
                notification.className = 'notification-success';
                notification.textContent = `‚úÖ App ${editingAppIndex !== null ? 'updated' : 'added'} successfully`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);

            } catch (error) {
                console.error('Error saving app:', error);
                alert('‚ùå Failed to save app: ' + error.message);
            }
        }

        // Delete app
        async function deleteApp(index) {
            const app = apps[index];
            if (!confirm(`Are you sure you want to delete "${app.title}"?`)) {
                return;
            }

            try {
                apps.splice(index, 1);
                await saveApps();
                await loadApps();

                const notification = document.createElement('div');
                notification.className = 'notification-success';
                notification.textContent = `‚úÖ "${app.title}" deleted successfully`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);

            } catch (error) {
                console.error('Error deleting app:', error);
                alert('‚ùå Failed to delete app: ' + error.message);
            }
        }

        // Analytics Dashboard Functions
        function openAnalytics() {
            const modal = document.getElementById('analyticsModal');
            modal.classList.add('active');
            loadAnalytics();
        }

        function closeAnalytics() {
            const modal = document.getElementById('analyticsModal');
            modal.classList.remove('active');
        }

        // Close analytics modal when clicking outside
        document.addEventListener('click', (e) => {
            const analyticsModal = document.getElementById('analyticsModal');
            if (e.target === analyticsModal) {
                closeAnalytics();
            }
        });

        // Load and display analytics
        async function loadAnalytics() {
            const refreshBtn = document.getElementById('refreshAnalyticsBtn');
            if (refreshBtn) {
                refreshBtn.disabled = true;
                refreshBtn.textContent = '‚è≥ Loading...';
            }

            try {
                // Load subscriber count
                let subscriberCount = 0;
                let historicalData = [];
                
                // Always try to fetch from JSONBin directly for analytics (more reliable)
                const binId = localStorage.getItem('jsonbin_bin_id') || '6967037143b1c97be92f1730';
                const accessKey = '$2a$10$.tte9gaAB5LnvRsH2dUz4OFuloHrp3GWDQsCdpRmgcfZ3uf4TYbsq';
                
                try {
                    console.log('üìä Fetching analytics data from JSONBin, bin ID:', binId);
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                        headers: { 'X-Access-Key': accessKey },
                        cache: 'no-store'
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('üìä JSONBin response:', result);
                        const data = result.record || result;
                        
                        // Handle both old format (array) and new format (object)
                        if (Array.isArray(data)) {
                            subscriberCount = data.length;
                            historicalData = [];
                            console.log('üìä Old format detected, subscribers:', subscriberCount);
                        } else {
                            const subscribers = data.subscribers || [];
                            subscriberCount = Array.isArray(subscribers) ? subscribers.length : (data.count || 0);
                            historicalData = data.historicalData || [];
                            
                            console.log('üìä New format detected, subscribers array length:', subscribers.length, 'count field:', data.count);
                            console.log('üìä Historical data points:', historicalData.length);
                            
                            // Store in localStorage for quick access
                            if (historicalData.length > 0) {
                                localStorage.setItem('newsletter_historical_data', JSON.stringify(historicalData));
                            }
                        }
                        console.log('‚úÖ Loaded from JSONBin:', subscriberCount, 'subscribers,', historicalData.length, 'historical data points');
                    } else {
                        console.error('‚ùå JSONBin response not OK:', response.status, response.statusText);
                        const errorText = await response.text();
                        console.error('‚ùå Error details:', errorText);
                    }
                } catch (error) {
                    console.error('‚ùå Error fetching from JSONBin:', error);
                    // Fallback to newsletterManager if available
                    if (typeof newsletterManager !== 'undefined') {
                        try {
                            subscriberCount = await newsletterManager.getSubscriberCount();
                            historicalData = await newsletterManager.getHistoricalDataForChart(30);
                            console.log('‚úÖ Fallback to newsletterManager:', subscriberCount, 'subscribers');
                        } catch (fallbackError) {
                            console.error('‚ùå Fallback also failed:', fallbackError);
                        }
                    }
                }

                // Load app count
                let appCount = 0;
                const appsBinId = localStorage.getItem('apps_bin_id') || '69670ee1d0ea881f406a814c';
                try {
                    const appsResponse = await fetch(`https://api.jsonbin.io/v3/b/${appsBinId}/latest`, {
                        cache: 'no-store'
                    });
                    if (appsResponse.ok) {
                        const appsResult = await appsResponse.json();
                        const appsData = appsResult.record || appsResult;
                        const apps = appsData.apps || [];
                        appCount = apps.length;
                    }
                } catch (e) {
                    console.log('Could not load app count:', e);
                }

                // Update stats
                document.getElementById('totalSubscribersStat').textContent = subscriberCount.toLocaleString();
                document.getElementById('totalAppsStat').textContent = appCount.toLocaleString();
                
                // Calculate growth rate (simplified - would need historical data for real calculation)
                const growthRate = subscriberCount > 0 ? '+12%' : '0%';
                document.getElementById('growthRateStat').textContent = growthRate;
                
                // Newsletter sends (would need to track this)
                document.getElementById('newsletterSendsStat').textContent = '‚Äî';

                // Create simple subscriber growth chart with real historical data
                await createSimpleChart(subscriberCount, historicalData);

                // Load recent activity
                loadRecentActivity(subscriberCount, appCount);

            } catch (error) {
                console.error('Error loading analytics:', error);
            } finally {
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshBtn.textContent = 'üîÑ Refresh Analytics';
                }
            }
        }

        // Create a simple chart visualization using real historical data
        async function createSimpleChart(currentCount, providedHistoricalData = null) {
            const chartContainer = document.getElementById('subscriberGrowthChart');
            if (!chartContainer) {
                console.error('Chart container not found');
                return;
            }

            console.log('Creating chart with subscriber count:', currentCount);

            // Use provided historical data, or fetch it
            let historicalData = providedHistoricalData || [];
            
            if (historicalData.length === 0) {
                // Try to get from localStorage
                try {
                    const stored = localStorage.getItem('newsletter_historical_data');
                    if (stored) {
                        const allData = JSON.parse(stored);
                        const cutoffDate = new Date();
                        cutoffDate.setDate(cutoffDate.getDate() - 30);
                        historicalData = allData.filter(s => new Date(s.date) >= cutoffDate)
                            .sort((a, b) => new Date(a.date) - new Date(b.date));
                    }
                } catch (error) {
                    console.error('Error loading historical data from localStorage:', error);
                }
            }
            
            // If still no data and newsletterManager is available, try to get fresh data
            if (historicalData.length === 0 && typeof newsletterManager !== 'undefined') {
                try {
                    const freshData = await newsletterManager.getHistoricalDataForChart(30);
                    if (freshData && freshData.length > 0) {
                        historicalData = freshData;
                    }
                } catch (error) {
                    console.warn('Could not fetch fresh historical data:', error);
                }
            }

            console.log('Historical data points:', historicalData.length);

            // Generate data points for last 30 days
            const days = 30;
            const dataPoints = [];
            const today = new Date();
            
            // Create a map of historical data by date for quick lookup
            const historicalMap = {};
            historicalData.forEach(item => {
                historicalMap[item.date] = item.count;
            });

            // Fill in data for each of the last 30 days
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                if (historicalMap[dateStr] !== undefined) {
                    // Use real historical data
                    dataPoints.push(historicalMap[dateStr]);
                } else {
                    // For days without data, use the previous day's count or 0
                    const prevIndex = dataPoints.length - 1;
                    const prevValue = prevIndex >= 0 ? dataPoints[prevIndex] : 0;
                    dataPoints.push(prevValue);
                }
            }

            // Ensure we have today's count
            if (dataPoints.length > 0) {
                dataPoints[dataPoints.length - 1] = currentCount;
            }

            // Create a simple bar chart using divs
            chartContainer.innerHTML = '';
            chartContainer.className = 'simple-chart';
            const maxValue = Math.max(...dataPoints, 1);
            
            console.log('Max value:', maxValue, 'Data points:', dataPoints.length);
            
            if (maxValue === 0 || currentCount === 0) {
                // Show empty state with a message
                chartContainer.innerHTML = '';
                chartContainer.className = '';
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'analytics-empty';
                emptyMsg.innerHTML = '<div class="analytics-empty-icon">üìä</div><p>No subscriber data yet</p><p class="analytics-empty-subtext">Start collecting subscribers to see growth trends</p>';
                chartContainer.appendChild(emptyMsg);
                return;
            }
            
            dataPoints.forEach((value, index) => {
                const bar = document.createElement('div');
                const height = maxValue > 0 ? Math.max(2, (value / maxValue) * 100) : 2; // Minimum 2% height for visibility
                bar.className = 'simple-chart-bar';
                bar.style.height = `${height}%`;
                
                // Calculate the date for this bar
                const barDate = new Date(today);
                barDate.setDate(barDate.getDate() - (days - 1 - index));
                const dateStr = barDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                bar.title = `${dateStr}: ${value} subscriber${value !== 1 ? 's' : ''}`;
                chartContainer.appendChild(bar);
            });
            
            console.log('Chart created with', dataPoints.length, 'bars using real historical data');
        }

        // Load recent activity
        function loadRecentActivity(subscriberCount, appCount) {
            const activityList = document.getElementById('recentActivityList');
            if (!activityList) return;

            const activities = [
                {
                    icon: 'üë•',
                    title: 'Subscriber Management',
                    description: `${subscriberCount} total subscribers`,
                    time: 'Just now'
                },
                {
                    icon: 'üì±',
                    title: 'App Management',
                    description: `${appCount} apps published`,
                    time: 'Just now'
                },
                {
                    icon: 'üìä',
                    title: 'Analytics Dashboard',
                    description: 'Viewing analytics data',
                    time: 'Just now'
                }
            ];

            activityList.innerHTML = activities.map(activity => `
                <div class="analytics-activity-item">
                    <div class="analytics-activity-icon">${activity.icon}</div>
                    <div class="analytics-activity-content">
                        <div class="analytics-activity-title">${activity.title}</div>
                        <div class="analytics-activity-time">${activity.description} ‚Ä¢ ${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkGitHubAuth();
        });
    </script>
    <script src="newsletter.js"></script>
</body>
</html> 